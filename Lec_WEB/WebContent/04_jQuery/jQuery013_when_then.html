<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>when & then</title>
<style>
.box1 {
	width:150px;
	height : 150px;
	background-color:  #3f8d3f;
	position: absolute;
	left : 50px;
	top : 0;
}
.box2 {
	width:150px;
	height:150px;
	background-color:  #82d3f2;
	position: absolute;
	left :50px;
	top :150px;
}
.box3 {
	width:150px;
	height:150px;
	background-color:  yellow;
	position: absolute;
	left :50px;
	top :300px;
}
</style>
</head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<script>
/*
	$.when() 함수는 
	thenable object 들 (다른말로 deferred object)들의
	이벤트가 끝나면 리턴타입은 Promise 객체 리턴
	https://api.jquery.com/jquery.when/
		  
	deferred.then() 함수
	deferred 들이 다 마무리 되면 콜백 함수 호출
	https://api.jquery.com/deferred.then/
 */
$(document).ready(function(){
	$("#run").click(function(e){
		  var $box1 = $(".box1");
		  var $box2 = $(".box2");
		  var $box3 = $(".box3");

		//   $box1.animate({left: "200px"}, 1000);
		//   $box2.animate({top: "0px"}, 1500);   
		//   $box3.animate({top: "150px"}, 2000);
		  
		// $box1 과 $box2 의 애니메이션이 다 끝나고 나서 $box3 이 움직이게 하려면? 

		// 방법 : box2 끝나고 수행
		// $box1.animate({left: "200px"}, 1000);
		// $box2.animate({top: "0px"}, 1500, function(){
		// 	$box3.animate({top: "150px"}, 2000);
		// });   
		  
		// 방법 : delay()
		// $box1.animate({left: "200px"}, 1000);
		// $box2.animate({top: "0px"}, 1500);   
		// $box3.delay(1500).animate({top: "150px"}, 2000);
		
		// $box1 과 $box2 중 누가 먼저 끝나는지 알 수 없다면,
		// 그리고 얼마 후에 끝나는지도 알 수 없다면? 
		// callback 함수 사용하지 않고서?

		// 방법
		// $.when() 사용 
		// 이벤트들이 끝나면 수행하는 Promise 객체 리턴
		// thenable object (다른 말로 deferred object)
		$box1.animate({left: "200px"}, 1000);
		$box2.animate({top: "0px"}, 1500);   
		
		$.when($box1, $box2).then(function(){
			alert("완료!");
			$box3.animate({top: "150px"}, 2000);
		}).then(function(){
			alert("완료!");
			$box3.animate({top: "150px"}, 2000);
		}).then(function(){
			alert("완료!");
			$box3.animate({top: "150px"}, 2000);
		}).then(function(){
			alert("완료!");
			$box3.animate({top: "150px"}, 2000);
		}).then(function(){
			alert("완료!");
			$box3.animate({top: "150px"}, 2000);
		})
		;
		  // 콜백 지옥에서 벗어나기 위해 -> 이런식으로 코드 사용 가능하다. 
		  //then 함수 사용해서 계속 해서 이어서 사용할 수 있다. 

		  $.when($box1.animate({left : "200px"}, 1000))
			.then(function(){
				return $.when($box2.animate({top : "0px"}, 1500));
			})
			.then(function(){
				return $box3.animate({top: "150px"}, 2000);
			})
		  ;


		  
	});	
});
</script>

<body>
<button id="run">run</button>
<div class="box1"></div>
<div class="box2"></div>
<div class="box3"></div>
<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
</body>
</html>
















